"use strict";

(function ($) {
  var $win = $(window);
  var $body = $('html,body');
  var $main = $('main');
  var windowHeight = $win.height();
  var headerHeight = $('header').outerHeight(true);
  var $navigation = $('.navigation');
  var $gotop = $('#gotop');
  var $timelineItem;
  var $nav;
  $main.css({
    paddingTop: headerHeight
  });

  var fetchData = function fetchData() {
    $.ajax({
      url: 'data.json',
      method: 'get',
      dataType: 'json',
      data: {},
      success: function success(data) {
        data = data || {};
        var $timeline = $('.timeline').append($(createTimeline(data)));
        $nav = $('.navigation').append(createTimelineYearNav(data));
        $timelineItem = $timeline.find('.timeline__item');
        winScorll();
        onYear();
      }
    });
  };

  var winScorll = function winScorll() {
    $win.on('scroll', function () {
      var $this = $(this);
      var scrollTop = $this.scrollTop();
      var totalHeight = $('main').offset().top + $('main').outerHeight(true) - windowHeight;
      var idx = 0;
      $timelineItem.map(function (i, e) {
        if (scrollTop > $(e).offset().top - 200) {
          idx = i;
        } else if (scrollTop > $(document).height() - $win.height() - $timelineItem.eq($timelineItem.length - 1).outerHeight(true) / 2) {
          idx = $timelineItem.length - 1;
        }
      });
      $nav.find('li').eq(idx).addClass('navigation__item--active').siblings().removeClass('navigation__item--active');
      $('.loadbar').css({
        width: scrollTop / totalHeight * 100 + '%'
      });

      if (scrollTop >= headerHeight) {
        $gotop.css({
          opacity: 1
        });
      } else {
        $gotop.css({
          opacity: 0
        });
      }
    }).scroll();
  };

  var onYear = function onYear() {
    $nav.on('click', 'li', function () {
      var $this = $(this);
      var idx = $(this).index();
      $body.stop().animate({
        scrollTop: idx === 0 ? 0 : $timelineItem.eq(idx).offset().top - (60 + headerHeight)
      });
    });
  };

  var createTimelineYearNav = function createTimelineYearNav(list) {
    return "<ul>" + list.map(function (e) {
      return "<li class=\"navigation__item\">".concat(e.year, "</li>");
    }).join('') + "</ul>";
  };

  var createTimeline = function createTimeline(list) {
    return list.map(function (e) {
      return "\n        <div class=\"timeline__item\">\n          <p class=\"timeline__item-year\">".concat(e.year, "</p>\n          ").concat(createTimelineItem(e.portfolio), "\n        </div>\n      ");
    }).join('');
  };

  var createTimelineItem = function createTimelineItem(item) {
    return item.map(function (e) {
      return "\n        <div class=\"timeline__item-content\">\n          <div class=\"card\">\n            <figure>\n            <img src=\"".concat(e.images, "\" alt=\"").concat(e.title, "\">\n            </figure>\n            <div class=\"card-summary\">\n              <div class=\"card-category\">").concat(e.device, "</div>\n              <h2>").concat(e.title, "</h2>\n              <div class=\"card-description\">").concat(e.description, "</div>\n            </div>\n            <a href=\"").concat(e.link, "\" target=\"_blank\"></a>\n          </div>\n        </div>\n        ");
    }).join('');
  };

  var flicker = {
    unicode: '!"#$%\'()*+,-./0123456789:;?@`aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ{[|}]~^_',
    getRandomInt: function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    },
    randomCharacter: function randomCharacter() {
      return this.unicode[Math.floor(Math.random() * this.unicode.length)];
    },
    replaceAt: function replaceAt(text, character, index) {
      return text.substr(0, index) + character + text.substr(index + character.length);
    },
    init: function init(el, min, max, delay) {
      var str = $(el).text().trim(),
          bank = [],
          done = 1,
          newStr = $(el).text().trim();

      for (var i = 0; i < str.length; i++) {
        bank[i] = this.getRandomInt(min, max);
      }

      flicker.mix(el, str, newStr, done, bank, delay);
    },
    mix: function mix(el, str, newStr, done, bank, delay) {
      for (var i = 0; i < str.length; i++) {
        if (bank[i] != 0) {
          done = 0;

          if (str[i] != ' ') {
            newStr = this.replaceAt(newStr, this.randomCharacter(), i);
          } else {
            newStr = this.replaceAt(newStr, ' ', i);
          }

          bank[i]--;
        } else {
          newStr = this.replaceAt(newStr, str[i], i);
        }
      }

      $(el).text(newStr).fadeIn(1000);

      if (done == 0) {
        setTimeout(function () {
          flicker.mix(el, str, newStr, done, bank, delay);
        }, delay);
      }
    }
  };
  $gotop.on('click', function () {
    $body.stop().animate({
      scrollTop: 0
    }, 500, 'swing');
  });
  fetchData();
  flicker.init('h1 span', 1, 15, 50);
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBvcnRmb2xpby5qcyJdLCJuYW1lcyI6WyIkIiwiJHdpbiIsIndpbmRvdyIsIiRib2R5IiwiJG1haW4iLCJ3aW5kb3dIZWlnaHQiLCJoZWlnaHQiLCJoZWFkZXJIZWlnaHQiLCJvdXRlckhlaWdodCIsIiRuYXZpZ2F0aW9uIiwiJGdvdG9wIiwiJHRpbWVsaW5lSXRlbSIsIiRuYXYiLCJjc3MiLCJwYWRkaW5nVG9wIiwiZmV0Y2hEYXRhIiwiYWpheCIsInVybCIsIm1ldGhvZCIsImRhdGFUeXBlIiwiZGF0YSIsInN1Y2Nlc3MiLCIkdGltZWxpbmUiLCJhcHBlbmQiLCJjcmVhdGVUaW1lbGluZSIsImNyZWF0ZVRpbWVsaW5lWWVhck5hdiIsImZpbmQiLCJ3aW5TY29ybGwiLCJvblllYXIiLCJvbiIsIiR0aGlzIiwic2Nyb2xsVG9wIiwidG90YWxIZWlnaHQiLCJvZmZzZXQiLCJ0b3AiLCJpZHgiLCJtYXAiLCJpIiwiZSIsImRvY3VtZW50IiwiZXEiLCJsZW5ndGgiLCJhZGRDbGFzcyIsInNpYmxpbmdzIiwicmVtb3ZlQ2xhc3MiLCJ3aWR0aCIsIm9wYWNpdHkiLCJzY3JvbGwiLCJpbmRleCIsInN0b3AiLCJhbmltYXRlIiwibGlzdCIsInllYXIiLCJqb2luIiwiY3JlYXRlVGltZWxpbmVJdGVtIiwicG9ydGZvbGlvIiwiaXRlbSIsImltYWdlcyIsInRpdGxlIiwiZGV2aWNlIiwiZGVzY3JpcHRpb24iLCJsaW5rIiwiZmxpY2tlciIsInVuaWNvZGUiLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21DaGFyYWN0ZXIiLCJyZXBsYWNlQXQiLCJ0ZXh0IiwiY2hhcmFjdGVyIiwic3Vic3RyIiwiaW5pdCIsImVsIiwiZGVsYXkiLCJzdHIiLCJ0cmltIiwiYmFuayIsImRvbmUiLCJuZXdTdHIiLCJtaXgiLCJmYWRlSW4iLCJzZXRUaW1lb3V0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsVUFB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T0FBTyxDQUFDcUIsR0FBUixDQUFZUCxFQUFaLEVBQWdCRSxHQUFoQixFQUFxQkksTUFBckIsRUFBNkJELElBQTdCLEVBQW1DRCxJQUFuQyxFQUF5Q0gsS0FBekM7QUFDRCxTQUZTLEVBRVBBLEtBRk8sQ0FBVjtBQUdEO0FBQ0Y7QUEzQ2EsR0FBaEI7QUE4Q0FuRSxFQUFBQSxNQUFNLENBQUNtQixFQUFQLENBQVUsT0FBVixFQUFtQixZQUFXO0FBQzVCMUIsSUFBQUEsS0FBSyxDQUFDOEMsSUFBTixHQUFhQyxPQUFiLENBQXFCO0FBQ25CbkIsTUFBQUEsU0FBUyxFQUFFO0FBRFEsS0FBckIsRUFFRSxHQUZGLEVBRU8sT0FGUDtBQUdELEdBSkQ7QUFRQWhCLEVBQUFBLFNBQVM7QUFDVCtDLEVBQUFBLE9BQU8sQ0FBQ2EsSUFBUixDQUFhLFNBQWIsRUFBd0IsQ0FBeEIsRUFBMkIsRUFBM0IsRUFBK0IsRUFBL0I7QUFDRCxDQWpMRCxFQWlMR1csTUFqTEgiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCQpIHtcbiAgY29uc3QgJHdpbiA9ICQod2luZG93KTtcbiAgY29uc3QgJGJvZHkgPSAkKCdodG1sLGJvZHknKTtcbiAgY29uc3QgJG1haW4gPSAkKCdtYWluJyk7XG4gIGNvbnN0IHdpbmRvd0hlaWdodCA9ICR3aW4uaGVpZ2h0KCk7XG4gIGNvbnN0IGhlYWRlckhlaWdodCA9ICQoJ2hlYWRlcicpLm91dGVySGVpZ2h0KHRydWUpO1xuICBjb25zdCAkbmF2aWdhdGlvbiA9ICQoJy5uYXZpZ2F0aW9uJyk7XG4gIGNvbnN0ICRnb3RvcCA9ICQoJyNnb3RvcCcpO1xuICBsZXQgJHRpbWVsaW5lSXRlbTtcbiAgbGV0ICRuYXY7XG5cbiAgJG1haW4uY3NzKHsgcGFkZGluZ1RvcDogaGVhZGVySGVpZ2h0IH0pO1xuXG4gIGNvbnN0IGZldGNoRGF0YSA9ICgpID0+IHtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiAnZGF0YS5qc29uJyxcbiAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgZGF0YToge30sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBkYXRhID0gZGF0YSB8fCB7fTtcblxuICAgICAgICBjb25zdCAkdGltZWxpbmUgPSAkKCcudGltZWxpbmUnKS5hcHBlbmQoJChjcmVhdGVUaW1lbGluZShkYXRhKSkpO1xuICAgICAgICAkbmF2ID0gJCgnLm5hdmlnYXRpb24nKS5hcHBlbmQoY3JlYXRlVGltZWxpbmVZZWFyTmF2KGRhdGEpKTtcbiAgICAgICAgJHRpbWVsaW5lSXRlbSA9ICR0aW1lbGluZS5maW5kKCcudGltZWxpbmVfX2l0ZW0nKTtcblxuICAgICAgICB3aW5TY29ybGwoKTtcbiAgICAgICAgb25ZZWFyKCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHdpblNjb3JsbCA9ICgpID0+IHtcbiAgICAkd2luXG4gICAgICAub24oJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICBjb25zdCBzY3JvbGxUb3AgPSAkdGhpcy5zY3JvbGxUb3AoKTtcbiAgICAgICAgY29uc3QgdG90YWxIZWlnaHQgPSAkKCdtYWluJykub2Zmc2V0KCkudG9wICsgJCgnbWFpbicpLm91dGVySGVpZ2h0KHRydWUpIC0gd2luZG93SGVpZ2h0O1xuICAgICAgICBsZXQgaWR4ID0gMDtcblxuICAgICAgICAkdGltZWxpbmVJdGVtLm1hcCgoaSwgZSkgPT4ge1xuICAgICAgICAgIGlmIChzY3JvbGxUb3AgPiAkKGUpLm9mZnNldCgpLnRvcCAtIDIwMCkge1xuICAgICAgICAgICAgaWR4ID0gaTtcbiAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgc2Nyb2xsVG9wID5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLmhlaWdodCgpIC0gJHdpbi5oZWlnaHQoKSAtICR0aW1lbGluZUl0ZW0uZXEoJHRpbWVsaW5lSXRlbS5sZW5ndGggLSAxKS5vdXRlckhlaWdodCh0cnVlKSAvIDJcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGlkeCA9ICR0aW1lbGluZUl0ZW0ubGVuZ3RoIC0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRuYXYuZmluZCgnbGknKS5lcShpZHgpLmFkZENsYXNzKCduYXZpZ2F0aW9uX19pdGVtLS1hY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCduYXZpZ2F0aW9uX19pdGVtLS1hY3RpdmUnKTtcbiAgICAgICAgJCgnLmxvYWRiYXInKS5jc3MoeyB3aWR0aDogKHNjcm9sbFRvcCAvIHRvdGFsSGVpZ2h0KSAqIDEwMCArICclJyB9KTtcblxuICAgICAgICBpZihzY3JvbGxUb3AgPj0gaGVhZGVySGVpZ2h0ICl7XG4gICAgICAgICAgJGdvdG9wLmNzcyh7IG9wYWNpdHk6IDEgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJGdvdG9wLmNzcyh7IG9wYWNpdHk6IDAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuc2Nyb2xsKCk7XG4gIH07XG5cbiAgY29uc3Qgb25ZZWFyID0gKCkgPT4ge1xuICAgICRuYXYub24oJ2NsaWNrJywgJ2xpJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgY29uc3QgaWR4ID0gJCh0aGlzKS5pbmRleCgpO1xuXG4gICAgICAkYm9keS5zdG9wKCkuYW5pbWF0ZSh7XG4gICAgICAgIHNjcm9sbFRvcDogaWR4ID09PSAwID8gMCA6ICR0aW1lbGluZUl0ZW0uZXEoaWR4KS5vZmZzZXQoKS50b3AgLSAoNjAgKyBoZWFkZXJIZWlnaHQpLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlVGltZWxpbmVZZWFyTmF2ID0gKGxpc3QpID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgYDx1bD5gICtcbiAgICAgIGxpc3RcbiAgICAgICAgLm1hcCgoZSkgPT4ge1xuICAgICAgICAgIHJldHVybiBgPGxpIGNsYXNzPVwibmF2aWdhdGlvbl9faXRlbVwiPiR7ZS55ZWFyfTwvbGk+YDtcbiAgICAgICAgfSlcbiAgICAgICAgLmpvaW4oJycpICtcbiAgICAgIGA8L3VsPmBcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZVRpbWVsaW5lID0gKGxpc3QpID0+IHtcbiAgICByZXR1cm4gbGlzdFxuICAgICAgLm1hcCgoZSkgPT4ge1xuICAgICAgICByZXR1cm4gYFxuICAgICAgICA8ZGl2IGNsYXNzPVwidGltZWxpbmVfX2l0ZW1cIj5cbiAgICAgICAgICA8cCBjbGFzcz1cInRpbWVsaW5lX19pdGVtLXllYXJcIj4ke2UueWVhcn08L3A+XG4gICAgICAgICAgJHtjcmVhdGVUaW1lbGluZUl0ZW0oZS5wb3J0Zm9saW8pfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG4gICAgICB9KVxuICAgICAgLmpvaW4oJycpO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZVRpbWVsaW5lSXRlbSA9IChpdGVtKSA9PiB7XG4gICAgcmV0dXJuIGl0ZW1cbiAgICAgIC5tYXAoKGUpID0+IHtcbiAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgPGRpdiBjbGFzcz1cInRpbWVsaW5lX19pdGVtLWNvbnRlbnRcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZFwiPlxuICAgICAgICAgICAgPGZpZ3VyZT5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiJHtlLmltYWdlc31cIiBhbHQ9XCIke2UudGl0bGV9XCI+XG4gICAgICAgICAgICA8L2ZpZ3VyZT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLXN1bW1hcnlcIj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtY2F0ZWdvcnlcIj4ke2UuZGV2aWNlfTwvZGl2PlxuICAgICAgICAgICAgICA8aDI+JHtlLnRpdGxlfTwvaDI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWRlc2NyaXB0aW9uXCI+JHtlLmRlc2NyaXB0aW9ufTwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8YSBocmVmPVwiJHtlLmxpbmt9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+PC9hPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgIH0pXG4gICAgICAuam9pbignJyk7XG4gIH07XG5cbiAgY29uc3QgZmxpY2tlciA9IHtcbiAgICB1bmljb2RlOiAnIVwiIyQlXFwnKCkqKywtLi8wMTIzNDU2Nzg5Ojs/QGBhQWJCY0NkRGVFZkZnR2hIaUlqSmtLbExtTW5Ob09wUHFRclJzU3RUdVV2VndXeFh5WXpae1t8fV1+Xl8nLFxuICAgIGdldFJhbmRvbUludDogZnVuY3Rpb24gKG1pbiwgbWF4KSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcbiAgICB9LFxuICAgIHJhbmRvbUNoYXJhY3RlcjogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMudW5pY29kZVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnVuaWNvZGUubGVuZ3RoKV07XG4gICAgfSxcbiAgICByZXBsYWNlQXQ6IGZ1bmN0aW9uICh0ZXh0LCBjaGFyYWN0ZXIsIGluZGV4KSB7XG4gICAgICByZXR1cm4gdGV4dC5zdWJzdHIoMCwgaW5kZXgpICsgY2hhcmFjdGVyICsgdGV4dC5zdWJzdHIoaW5kZXggKyBjaGFyYWN0ZXIubGVuZ3RoKTtcbiAgICB9LFxuICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgbWluLCBtYXgsIGRlbGF5KSB7XG4gICAgICB2YXIgc3RyID0gJChlbCkudGV4dCgpLnRyaW0oKSxcbiAgICAgICAgYmFuayA9IFtdLFxuICAgICAgICBkb25lID0gMSxcbiAgICAgICAgbmV3U3RyID0gJChlbCkudGV4dCgpLnRyaW0oKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYmFua1tpXSA9IHRoaXMuZ2V0UmFuZG9tSW50KG1pbiwgbWF4KTtcbiAgICAgIH1cbiAgICAgIGZsaWNrZXIubWl4KGVsLCBzdHIsIG5ld1N0ciwgZG9uZSwgYmFuaywgZGVsYXkpO1xuICAgIH0sXG4gICAgbWl4OiBmdW5jdGlvbiAoZWwsIHN0ciwgbmV3U3RyLCBkb25lLCBiYW5rLCBkZWxheSkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGJhbmtbaV0gIT0gMCkge1xuICAgICAgICAgIGRvbmUgPSAwO1xuICAgICAgICAgIGlmIChzdHJbaV0gIT0gJyAnKSB7XG4gICAgICAgICAgICBuZXdTdHIgPSB0aGlzLnJlcGxhY2VBdChuZXdTdHIsIHRoaXMucmFuZG9tQ2hhcmFjdGVyKCksIGkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXdTdHIgPSB0aGlzLnJlcGxhY2VBdChuZXdTdHIsICcgJywgaSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJhbmtbaV0tLTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXdTdHIgPSB0aGlzLnJlcGxhY2VBdChuZXdTdHIsIHN0cltpXSwgaSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJChlbCkudGV4dChuZXdTdHIpLmZhZGVJbigxMDAwKTtcbiAgICAgIGlmIChkb25lID09IDApIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZmxpY2tlci5taXgoZWwsIHN0ciwgbmV3U3RyLCBkb25lLCBiYW5rLCBkZWxheSk7XG4gICAgICAgIH0sIGRlbGF5KTtcbiAgICAgIH1cbiAgICB9LFxuICB9O1xuXG4gICRnb3RvcC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkYm9keS5zdG9wKCkuYW5pbWF0ZSh7XG4gICAgICBzY3JvbGxUb3A6IDAsXG4gICAgfSw1MDAsICdzd2luZycgKTtcbiAgfSlcbiAgXG4gIFxuXG4gIGZldGNoRGF0YSgpO1xuICBmbGlja2VyLmluaXQoJ2gxIHNwYW4nLCAxLCAxNSwgNTApO1xufSkoalF1ZXJ5KTtcbiJdLCJmaWxlIjoicG9ydGZvbGlvLmpzIn0=
