"use strict";

(function ($) {
  var $win = $(window);
  var $body = $('html,body');
  var $main = $('main');
  var windowHeight = $win.height();
  var headerHeight = $('header').outerHeight(true);
  var $navigation = $('.navigation');
  $gotop;
  var $timelineItem;
  var $nav;
  $main.css({
    paddingTop: headerHeight
  });

  var fetchData = function fetchData() {
    $.ajax({
      url: 'data.json',
      method: 'get',
      dataType: 'json',
      data: {},
      success: function success(data) {
        data = data || {};
        var $timeline = $('.timeline').append($(createTimeline(data)));
        $nav = $('.navigation').append(createTimelineYearNav(data));
        $timelineItem = $timeline.find('.timeline__item');
        winScorll();
        onYear();
      }
    });
  };

  var winScorll = function winScorll() {
    $win.on('scroll', function () {
      var $this = $(this);
      var scrollTop = $this.scrollTop();
      var totalHeight = $('main').offset().top + $('main').outerHeight(true) - windowHeight;
      var idx = 0;
      $timelineItem.map(function (i, e) {
        if (scrollTop > $(e).offset().top - 200) {
          idx = i;
        } else if (scrollTop > $(document).height() - $win.height() - $timelineItem.eq($timelineItem.length - 1).outerHeight(true) / 2) {
          idx = $timelineItem.length - 1;
        }
      });
      $nav.find('li').eq(idx).addClass('navigation__item--active').siblings().removeClass('navigation__item--active');
      $('.loadbar').css({
        width: scrollTop / totalHeight * 100 + '%'
      });

      if (scrollTop >= headerHeight) {
        $gotop.css({
          opacity: 1
        });
      } else {
        $gotop.css({
          opacity: 0
        });
      }
    }).scroll();
  };

  var onYear = function onYear() {
    $nav.on('click', 'li', function () {
      var $this = $(this);
      var idx = $(this).index();
      $body.stop().animate({
        scrollTop: idx === 0 ? 0 : $timelineItem.eq(idx).offset().top - (60 + headerHeight)
      });
    });
  };

  var createTimelineYearNav = function createTimelineYearNav(list) {
    return "<ul>" + list.map(function (e) {
      return "<li class=\"navigation__item\">".concat(e.year, "</li>");
    }).join('') + "</ul>";
  };

  var createTimeline = function createTimeline(list) {
    return list.map(function (e) {
      return "\n        <div class=\"timeline__item\">\n          <p class=\"timeline__item-year\">".concat(e.year, "</p>\n          ").concat(createTimelineItem(e.portfolio), "\n        </div>\n      ");
    }).join('');
  };

  var createTimelineItem = function createTimelineItem(item) {
    return item.map(function (e) {
      return "\n        <div class=\"timeline__item-content\">\n          <div class=\"card\">\n            <figure>\n            <img src=\"".concat(e.images, "\" alt=\"").concat(e.title, "\">\n            </figure>\n            <div class=\"card-summary\">\n              <div class=\"card-category\">").concat(e.device, "</div>\n              <h2>").concat(e.title, "</h2>\n              <div class=\"card-description\">").concat(e.description, "</div>\n            </div>\n            <a href=\"").concat(e.link, "\" target=\"_blank\"></a>\n          </div>\n        </div>\n        ");
    }).join('');
  };

  var flicker = {
    unicode: '!"#$%\'()*+,-./0123456789:;?@`aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ{[|}]~^_',
    getRandomInt: function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    },
    randomCharacter: function randomCharacter() {
      return this.unicode[Math.floor(Math.random() * this.unicode.length)];
    },
    replaceAt: function replaceAt(text, character, index) {
      return text.substr(0, index) + character + text.substr(index + character.length);
    },
    init: function init(el, min, max, delay) {
      var str = $(el).text().trim(),
          bank = [],
          done = 1,
          newStr = $(el).text().trim();

      for (var i = 0; i < str.length; i++) {
        bank[i] = this.getRandomInt(min, max);
      }

      flicker.mix(el, str, newStr, done, bank, delay);
    },
    mix: function mix(el, str, newStr, done, bank, delay) {
      for (var i = 0; i < str.length; i++) {
        if (bank[i] != 0) {
          done = 0;

          if (str[i] != ' ') {
            newStr = this.replaceAt(newStr, this.randomCharacter(), i);
          } else {
            newStr = this.replaceAt(newStr, ' ', i);
          }

          bank[i]--;
        } else {
          newStr = this.replaceAt(newStr, str[i], i);
        }
      }

      $(el).text(newStr).fadeIn(1000);

      if (done == 0) {
        setTimeout(function () {
          flicker.mix(el, str, newStr, done, bank, delay);
        }, delay);
      }
    }
  };
  $gotop.on('click', function () {
    $body.stop().animate({
      scrollTop: 0
    }, 500, 'swing');
  });
  fetchData();
  flicker.init('h1 span', 1, 15, 50);
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBvcnRmb2xpby5qcyJdLCJuYW1lcyI6WyIkIiwiJHdpbiIsIndpbmRvdyIsIiRib2R5IiwiJG1haW4iLCJ3aW5kb3dIZWlnaHQiLCJoZWlnaHQiLCJoZWFkZXJIZWlnaHQiLCJvdXRlckhlaWdodCIsIiRuYXZpZ2F0aW9uIiwiJGdvdG9wIiwiJHRpbWVsaW5lSXRlbSIsIiRuYXYiLCJjc3MiLCJwYWRkaW5nVG9wIiwiZmV0Y2hEYXRhIiwiYWpheCIsInVybCIsIm1ldGhvZCIsImRhdGFUeXBlIiwiZGF0YSIsInN1Y2Nlc3MiLCIkdGltZWxpbmUiLCJhcHBlbmQiLCJjcmVhdGVUaW1lbGluZSIsImNyZWF0ZVRpbWVsaW5lWWVhck5hdiIsImZpbmQiLCJ3aW5TY29ybGwiLCJvblllYXIiLCJvbiIsIiR0aGlzIiwic2Nyb2xsVG9wIiwidG90YWxIZWlnaHQiLCJvZmZzZXQiLCJ0b3AiLCJpZHgiLCJtYXAiLCJpIiwiZSIsImRvY3VtZW50IiwiZXEiLCJsZW5ndGgiLCJhZGRDbGFzcyIsInNpYmxpbmdzIiwicmVtb3ZlQ2xhc3MiLCJ3aWR0aCIsIm9wYWNpdHkiLCJzY3JvbGwiLCJpbmRleCIsInN0b3AiLCJhbmltYXRlIiwibGlzdCIsInllYXIiLCJqb2luIiwiY3JlYXRlVGltZWxpbmVJdGVtIiwicG9ydGZvbGlvIiwiaXRlbSIsImltYWdlcyIsInRpdGxlIiwiZGV2aWNlIiwiZGVzY3JpcHRpb24iLCJsaW5rIiwiZmxpY2tlciIsInVuaWNvZGUiLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21DaGFyYWN0ZXIiLCJyZXBsYWNlQXQiLCJ0ZXh0IiwiY2hhcmFjdGVyIiwic3Vic3RyIiwiaW5pdCIsImVsIiwiZGVsYXkiLCJzdHIiLCJ0cmltIiwiYmFuayIsImRvbmUiLCJuZXdTdHIiLCJtaXgiLCJmYWRlSW4iLCJzZXRUaW1lb3V0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsVUFBVUEsQ0FBVixFQUFhO0FBQ1osTUFBTUMsSUFBSSxHQUFHRCxDQUFDLENBQUNFLE1BQUQsQ0FBZDtBQUNBLE1BQU1DLEtBQUssR0FBR0gsQ0FBQyxDQUFDLFdBQUQsQ0FBZjtBQUNBLE1BQU1JLEtBQUssR0FBR0osQ0FBQyxDQUFDLE1BQUQsQ0FBZjtBQUNBLE1BQU1LLFlBQVksR0FBR0osSUFBSSxDQUFDSyxNQUFMLEVBQXJCO0FBQ0EsTUFBTUMsWUFBWSxHQUFHUCxDQUFDLENBQUMsUUFBRCxDQUFELENBQVlRLFdBQVosQ0FBd0IsSUFBeEIsQ0FBckI7QUFDQSxNQUFNQyxXQUFXLEdBQUdULENBQUMsQ0FBQyxhQUFELENBQXJCO0FBQ0FVLEVBQUFBLE1BQU07QUFDTixNQUFJQyxhQUFKO0FBQ0EsTUFBSUMsSUFBSjtBQUVBUixFQUFBQSxLQUFLLENBQUNTLEdBQU4sQ0FBVTtBQUFFQyxJQUFBQSxVQUFVLEVBQUVQO0FBQWQsR0FBVjs7QUFFQSxNQUFNUSxTQUFTLEdBQUcsU0FBWkEsU0FBWSxHQUFNO0FBQ3RCZixJQUFBQSxDQUFDLENBQUNnQixJQUFGLENBQU87QUFDTEMsTUFBQUEsR0FBRyxFQUFFLFdBREE7QUFFTEMsTUFBQUEsTUFBTSxFQUFFLEtBRkg7QUFHTEMsTUFBQUEsUUFBUSxFQUFFLE1BSEw7QUFJTEMsTUFBQUEsSUFBSSxFQUFFLEVBSkQ7QUFLTEMsTUFBQUEsT0FBTyxFQUFFLGlCQUFVRCxJQUFWLEVBQWdCO0FBQ3ZCQSxRQUFBQSxJQUFJLEdBQUdBLElBQUksSUFBSSxFQUFmO0FBRUEsWUFBTUUsU0FBUyxHQUFHdEIsQ0FBQyxDQUFDLFdBQUQsQ0FBRCxDQUFldUIsTUFBZixDQUFzQnZCLENBQUMsQ0FBQ3dCLGNBQWMsQ0FBQ0osSUFBRCxDQUFmLENBQXZCLENBQWxCO0FBQ0FSLFFBQUFBLElBQUksR0FBR1osQ0FBQyxDQUFDLGFBQUQsQ0FBRCxDQUFpQnVCLE1BQWpCLENBQXdCRSxxQkFBcUIsQ0FBQ0wsSUFBRCxDQUE3QyxDQUFQO0FBQ0FULFFBQUFBLGFBQWEsR0FBR1csU0FBUyxDQUFDSSxJQUFWLENBQWUsaUJBQWYsQ0FBaEI7QUFFQUMsUUFBQUEsU0FBUztBQUNUQyxRQUFBQSxNQUFNO0FBQ1A7QUFkSSxLQUFQO0FBZ0JELEdBakJEOztBQW1CQSxNQUFNRCxTQUFTLEdBQUcsU0FBWkEsU0FBWSxHQUFNO0FBQ3RCMUIsSUFBQUEsSUFBSSxDQUNENEIsRUFESCxDQUNNLFFBRE4sRUFDZ0IsWUFBWTtBQUN4QixVQUFNQyxLQUFLLEdBQUc5QixDQUFDLENBQUMsSUFBRCxDQUFmO0FBQ0EsVUFBTStCLFNBQVMsR0FBR0QsS0FBSyxDQUFDQyxTQUFOLEVBQWxCO0FBQ0EsVUFBTUMsV0FBVyxHQUFHaEMsQ0FBQyxDQUFDLE1BQUQsQ0FBRCxDQUFVaUMsTUFBVixHQUFtQkMsR0FBbkIsR0FBeUJsQyxDQUFDLENBQUMsTUFBRCxDQUFELENBQVVRLFdBQVYsQ0FBc0IsSUFBdEIsQ0FBekIsR0FBdURILFlBQTNFO0FBQ0EsVUFBSThCLEdBQUcsR0FBRyxDQUFWO0FBRUF4QixNQUFBQSxhQUFhLENBQUN5QixHQUFkLENBQWtCLFVBQUNDLENBQUQsRUFBSUMsQ0FBSixFQUFVO0FBQzFCLFlBQUlQLFNBQVMsR0FBRy9CLENBQUMsQ0FBQ3NDLENBQUQsQ0FBRCxDQUFLTCxNQUFMLEdBQWNDLEdBQWQsR0FBb0IsR0FBcEMsRUFBeUM7QUFDdkNDLFVBQUFBLEdBQUcsR0FBR0UsQ0FBTjtBQUNELFNBRkQsTUFFTyxJQUNMTixTQUFTLEdBQ1QvQixDQUFDLENBQUN1QyxRQUFELENBQUQsQ0FBWWpDLE1BQVosS0FBdUJMLElBQUksQ0FBQ0ssTUFBTCxFQUF2QixHQUF1Q0ssYUFBYSxDQUFDNkIsRUFBZCxDQUFpQjdCLGFBQWEsQ0FBQzhCLE1BQWQsR0FBdUIsQ0FBeEMsRUFBMkNqQyxXQUEzQyxDQUF1RCxJQUF2RCxJQUErRCxDQUZqRyxFQUdMO0FBQ0EyQixVQUFBQSxHQUFHLEdBQUd4QixhQUFhLENBQUM4QixNQUFkLEdBQXVCLENBQTdCO0FBQ0Q7QUFDRixPQVREO0FBV0E3QixNQUFBQSxJQUFJLENBQUNjLElBQUwsQ0FBVSxJQUFWLEVBQWdCYyxFQUFoQixDQUFtQkwsR0FBbkIsRUFBd0JPLFFBQXhCLENBQWlDLDBCQUFqQyxFQUE2REMsUUFBN0QsR0FBd0VDLFdBQXhFLENBQW9GLDBCQUFwRjtBQUNBNUMsTUFBQUEsQ0FBQyxDQUFDLFVBQUQsQ0FBRCxDQUFjYSxHQUFkLENBQWtCO0FBQUVnQyxRQUFBQSxLQUFLLEVBQUdkLFNBQVMsR0FBR0MsV0FBYixHQUE0QixHQUE1QixHQUFrQztBQUEzQyxPQUFsQjs7QUFFQSxVQUFHRCxTQUFTLElBQUl4QixZQUFoQixFQUE4QjtBQUM1QkcsUUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVc7QUFBRWlDLFVBQUFBLE9BQU8sRUFBRTtBQUFYLFNBQVg7QUFDRCxPQUZELE1BRU87QUFDTHBDLFFBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXO0FBQUVpQyxVQUFBQSxPQUFPLEVBQUU7QUFBWCxTQUFYO0FBQ0Q7QUFDRixLQTFCSCxFQTJCR0MsTUEzQkg7QUE0QkQsR0E3QkQ7O0FBK0JBLE1BQU1uQixNQUFNLEdBQUcsU0FBVEEsTUFBUyxHQUFNO0FBQ25CaEIsSUFBQUEsSUFBSSxDQUFDaUIsRUFBTCxDQUFRLE9BQVIsRUFBaUIsSUFBakIsRUFBdUIsWUFBWTtBQUNqQyxVQUFNQyxLQUFLLEdBQUc5QixDQUFDLENBQUMsSUFBRCxDQUFmO0FBQ0EsVUFBTW1DLEdBQUcsR0FBR25DLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUWdELEtBQVIsRUFBWjtBQUVBN0MsTUFBQUEsS0FBSyxDQUFDOEMsSUFBTixHQUFhQyxPQUFiLENBQXFCO0FBQ25CbkIsUUFBQUEsU0FBUyxFQUFFSSxHQUFHLEtBQUssQ0FBUixHQUFZLENBQVosR0FBZ0J4QixhQUFhLENBQUM2QixFQUFkLENBQWlCTCxHQUFqQixFQUFzQkYsTUFBdEIsR0FBK0JDLEdBQS9CLElBQXNDLEtBQUszQixZQUEzQztBQURSLE9BQXJCO0FBR0QsS0FQRDtBQVFELEdBVEQ7O0FBV0EsTUFBTWtCLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsQ0FBQzBCLElBQUQsRUFBVTtBQUN0QyxXQUNFLFNBQ0FBLElBQUksQ0FDRGYsR0FESCxDQUNPLFVBQUNFLENBQUQsRUFBTztBQUNWLHNEQUF1Q0EsQ0FBQyxDQUFDYyxJQUF6QztBQUNELEtBSEgsRUFJR0MsSUFKSCxDQUlRLEVBSlIsQ0FEQSxVQURGO0FBU0QsR0FWRDs7QUFZQSxNQUFNN0IsY0FBYyxHQUFHLFNBQWpCQSxjQUFpQixDQUFDMkIsSUFBRCxFQUFVO0FBQy9CLFdBQU9BLElBQUksQ0FDUmYsR0FESSxDQUNBLFVBQUNFLENBQUQsRUFBTztBQUNWLDRHQUVtQ0EsQ0FBQyxDQUFDYyxJQUZyQyw2QkFHSUUsa0JBQWtCLENBQUNoQixDQUFDLENBQUNpQixTQUFILENBSHRCO0FBTUQsS0FSSSxFQVNKRixJQVRJLENBU0MsRUFURCxDQUFQO0FBVUQsR0FYRDs7QUFhQSxNQUFNQyxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQXFCLENBQUNFLElBQUQsRUFBVTtBQUNuQyxXQUFPQSxJQUFJLENBQ1JwQixHQURJLENBQ0EsVUFBQ0UsQ0FBRCxFQUFPO0FBQ1Ysc0pBSWdCQSxDQUFDLENBQUNtQixNQUpsQixzQkFJa0NuQixDQUFDLENBQUNvQixLQUpwQyw4SEFPbUNwQixDQUFDLENBQUNxQixNQVByQyx1Q0FRWXJCLENBQUMsQ0FBQ29CLEtBUmQsa0VBU3NDcEIsQ0FBQyxDQUFDc0IsV0FUeEMsK0RBV2V0QixDQUFDLENBQUN1QixJQVhqQjtBQWVELEtBakJJLEVBa0JKUixJQWxCSSxDQWtCQyxFQWxCRCxDQUFQO0FBbUJELEdBcEJEOztBQXNCQSxNQUFNUyxPQUFPLEdBQUc7QUFDZEMsSUFBQUEsT0FBTyxFQUFFLDRGQURLO0FBRWRDLElBQUFBLFlBQVksRUFBRSxzQkFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQ2hDLGFBQU9DLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsTUFBaUJILEdBQUcsR0FBR0QsR0FBTixHQUFZLENBQTdCLENBQVgsSUFBOENBLEdBQXJEO0FBQ0QsS0FKYTtBQUtkSyxJQUFBQSxlQUFlLEVBQUUsMkJBQVk7QUFDM0IsYUFBTyxLQUFLUCxPQUFMLENBQWFJLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsS0FBZ0IsS0FBS04sT0FBTCxDQUFhdEIsTUFBeEMsQ0FBYixDQUFQO0FBQ0QsS0FQYTtBQVFkOEIsSUFBQUEsU0FBUyxFQUFFLG1CQUFVQyxJQUFWLEVBQWdCQyxTQUFoQixFQUEyQnpCLEtBQTNCLEVBQWtDO0FBQzNDLGFBQU93QixJQUFJLENBQUNFLE1BQUwsQ0FBWSxDQUFaLEVBQWUxQixLQUFmLElBQXdCeUIsU0FBeEIsR0FBb0NELElBQUksQ0FBQ0UsTUFBTCxDQUFZMUIsS0FBSyxHQUFHeUIsU0FBUyxDQUFDaEMsTUFBOUIsQ0FBM0M7QUFDRCxLQVZhO0FBV2RrQyxJQUFBQSxJQUFJLEVBQUUsY0FBVUMsRUFBVixFQUFjWCxHQUFkLEVBQW1CQyxHQUFuQixFQUF3QlcsS0FBeEIsRUFBK0I7QUFDbkMsVUFBSUMsR0FBRyxHQUFHOUUsQ0FBQyxDQUFDNEUsRUFBRCxDQUFELENBQU1KLElBQU4sR0FBYU8sSUFBYixFQUFWO0FBQUEsVUFDRUMsSUFBSSxHQUFHLEVBRFQ7QUFBQSxVQUVFQyxJQUFJLEdBQUcsQ0FGVDtBQUFBLFVBR0VDLE1BQU0sR0FBR2xGLENBQUMsQ0FBQzRFLEVBQUQsQ0FBRCxDQUFNSixJQUFOLEdBQWFPLElBQWIsRUFIWDs7QUFLQSxXQUFLLElBQUkxQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHeUMsR0FBRyxDQUFDckMsTUFBeEIsRUFBZ0NKLENBQUMsRUFBakMsRUFBcUM7QUFDbkMyQyxRQUFBQSxJQUFJLENBQUMzQyxDQUFELENBQUosR0FBVSxLQUFLMkIsWUFBTCxDQUFrQkMsR0FBbEIsRUFBdUJDLEdBQXZCLENBQVY7QUFDRDs7QUFDREosTUFBQUEsT0FBTyxDQUFDcUIsR0FBUixDQUFZUCxFQUFaLEVBQWdCRSxHQUFoQixFQUFxQkksTUFBckIsRUFBNkJELElBQTdCLEVBQW1DRCxJQUFuQyxFQUF5Q0gsS0FBekM7QUFDRCxLQXJCYTtBQXNCZE0sSUFBQUEsR0FBRyxFQUFFLGFBQVVQLEVBQVYsRUFBY0UsR0FBZCxFQUFtQkksTUFBbkIsRUFBMkJELElBQTNCLEVBQWlDRCxJQUFqQyxFQUF1Q0gsS0FBdkMsRUFBOEM7QUFDakQsV0FBSyxJQUFJeEMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR3lDLEdBQUcsQ0FBQ3JDLE1BQXhCLEVBQWdDSixDQUFDLEVBQWpDLEVBQXFDO0FBQ25DLFlBQUkyQyxJQUFJLENBQUMzQyxDQUFELENBQUosSUFBVyxDQUFmLEVBQWtCO0FBQ2hCNEMsVUFBQUEsSUFBSSxHQUFHLENBQVA7O0FBQ0EsY0FBSUgsR0FBRyxDQUFDekMsQ0FBRCxDQUFILElBQVUsR0FBZCxFQUFtQjtBQUNqQjZDLFlBQUFBLE1BQU0sR0FBRyxLQUFLWCxTQUFMLENBQWVXLE1BQWYsRUFBdUIsS0FBS1osZUFBTCxFQUF2QixFQUErQ2pDLENBQS9DLENBQVQ7QUFDRCxXQUZELE1BRU87QUFDTDZDLFlBQUFBLE1BQU0sR0FBRyxLQUFLWCxTQUFMLENBQWVXLE1BQWYsRUFBdUIsR0FBdkIsRUFBNEI3QyxDQUE1QixDQUFUO0FBQ0Q7O0FBQ0QyQyxVQUFBQSxJQUFJLENBQUMzQyxDQUFELENBQUo7QUFDRCxTQVJELE1BUU87QUFDTDZDLFVBQUFBLE1BQU0sR0FBRyxLQUFLWCxTQUFMLENBQWVXLE1BQWYsRUFBdUJKLEdBQUcsQ0FBQ3pDLENBQUQsQ0FBMUIsRUFBK0JBLENBQS9CLENBQVQ7QUFDRDtBQUNGOztBQUVEckMsTUFBQUEsQ0FBQyxDQUFDNEUsRUFBRCxDQUFELENBQU1KLElBQU4sQ0FBV1UsTUFBWCxFQUFtQkUsTUFBbkIsQ0FBMEIsSUFBMUI7O0FBQ0EsVUFBSUgsSUFBSSxJQUFJLENBQVosRUFBZTtBQUNiSSxRQUFBQSxVQUFVLENBQUMsWUFBWTtBQUNyQnZCLFVBQUFBLE9BQU8sQ0FBQ3FCLEdBQVIsQ0FBWVAsRUFBWixFQUFnQkUsR0FBaEIsRUFBcUJJLE1BQXJCLEVBQTZCRCxJQUE3QixFQUFtQ0QsSUFBbkMsRUFBeUNILEtBQXpDO0FBQ0QsU0FGUyxFQUVQQSxLQUZPLENBQVY7QUFHRDtBQUNGO0FBM0NhLEdBQWhCO0FBOENBbkUsRUFBQUEsTUFBTSxDQUFDbUIsRUFBUCxDQUFVLE9BQVYsRUFBbUIsWUFBVztBQUM1QjFCLElBQUFBLEtBQUssQ0FBQzhDLElBQU4sR0FBYUMsT0FBYixDQUFxQjtBQUNuQm5CLE1BQUFBLFNBQVMsRUFBRTtBQURRLEtBQXJCLEVBRUUsR0FGRixFQUVPLE9BRlA7QUFHRCxHQUpEO0FBUUFoQixFQUFBQSxTQUFTO0FBQ1QrQyxFQUFBQSxPQUFPLENBQUNhLElBQVIsQ0FBYSxTQUFiLEVBQXdCLENBQXhCLEVBQTJCLEVBQTNCLEVBQStCLEVBQS9CO0FBQ0QsQ0FqTEQsRUFpTEdXLE1BakxIIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgkKSB7XHJcbiAgY29uc3QgJHdpbiA9ICQod2luZG93KTtcclxuICBjb25zdCAkYm9keSA9ICQoJ2h0bWwsYm9keScpO1xyXG4gIGNvbnN0ICRtYWluID0gJCgnbWFpbicpO1xyXG4gIGNvbnN0IHdpbmRvd0hlaWdodCA9ICR3aW4uaGVpZ2h0KCk7XHJcbiAgY29uc3QgaGVhZGVySGVpZ2h0ID0gJCgnaGVhZGVyJykub3V0ZXJIZWlnaHQodHJ1ZSk7XHJcbiAgY29uc3QgJG5hdmlnYXRpb24gPSAkKCcubmF2aWdhdGlvbicpO1xyXG4gICRnb3RvcDtcclxuICBsZXQgJHRpbWVsaW5lSXRlbTtcclxuICBsZXQgJG5hdjtcclxuXHJcbiAgJG1haW4uY3NzKHsgcGFkZGluZ1RvcDogaGVhZGVySGVpZ2h0IH0pO1xyXG5cclxuICBjb25zdCBmZXRjaERhdGEgPSAoKSA9PiB7XHJcbiAgICAkLmFqYXgoe1xyXG4gICAgICB1cmw6ICdkYXRhLmpzb24nLFxyXG4gICAgICBtZXRob2Q6ICdnZXQnLFxyXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICBkYXRhOiB7fSxcclxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICBkYXRhID0gZGF0YSB8fCB7fTtcclxuXHJcbiAgICAgICAgY29uc3QgJHRpbWVsaW5lID0gJCgnLnRpbWVsaW5lJykuYXBwZW5kKCQoY3JlYXRlVGltZWxpbmUoZGF0YSkpKTtcclxuICAgICAgICAkbmF2ID0gJCgnLm5hdmlnYXRpb24nKS5hcHBlbmQoY3JlYXRlVGltZWxpbmVZZWFyTmF2KGRhdGEpKTtcclxuICAgICAgICAkdGltZWxpbmVJdGVtID0gJHRpbWVsaW5lLmZpbmQoJy50aW1lbGluZV9faXRlbScpO1xyXG5cclxuICAgICAgICB3aW5TY29ybGwoKTtcclxuICAgICAgICBvblllYXIoKTtcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHdpblNjb3JsbCA9ICgpID0+IHtcclxuICAgICR3aW5cclxuICAgICAgLm9uKCdzY3JvbGwnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9ICR0aGlzLnNjcm9sbFRvcCgpO1xyXG4gICAgICAgIGNvbnN0IHRvdGFsSGVpZ2h0ID0gJCgnbWFpbicpLm9mZnNldCgpLnRvcCArICQoJ21haW4nKS5vdXRlckhlaWdodCh0cnVlKSAtIHdpbmRvd0hlaWdodDtcclxuICAgICAgICBsZXQgaWR4ID0gMDtcclxuXHJcbiAgICAgICAgJHRpbWVsaW5lSXRlbS5tYXAoKGksIGUpID0+IHtcclxuICAgICAgICAgIGlmIChzY3JvbGxUb3AgPiAkKGUpLm9mZnNldCgpLnRvcCAtIDIwMCkge1xyXG4gICAgICAgICAgICBpZHggPSBpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChcclxuICAgICAgICAgICAgc2Nyb2xsVG9wID5cclxuICAgICAgICAgICAgJChkb2N1bWVudCkuaGVpZ2h0KCkgLSAkd2luLmhlaWdodCgpIC0gJHRpbWVsaW5lSXRlbS5lcSgkdGltZWxpbmVJdGVtLmxlbmd0aCAtIDEpLm91dGVySGVpZ2h0KHRydWUpIC8gMlxyXG4gICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGlkeCA9ICR0aW1lbGluZUl0ZW0ubGVuZ3RoIC0gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJG5hdi5maW5kKCdsaScpLmVxKGlkeCkuYWRkQ2xhc3MoJ25hdmlnYXRpb25fX2l0ZW0tLWFjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ25hdmlnYXRpb25fX2l0ZW0tLWFjdGl2ZScpO1xyXG4gICAgICAgICQoJy5sb2FkYmFyJykuY3NzKHsgd2lkdGg6IChzY3JvbGxUb3AgLyB0b3RhbEhlaWdodCkgKiAxMDAgKyAnJScgfSk7XHJcblxyXG4gICAgICAgIGlmKHNjcm9sbFRvcCA+PSBoZWFkZXJIZWlnaHQgKXtcclxuICAgICAgICAgICRnb3RvcC5jc3MoeyBvcGFjaXR5OiAxIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAkZ290b3AuY3NzKHsgb3BhY2l0eTogMCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5zY3JvbGwoKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBvblllYXIgPSAoKSA9PiB7XHJcbiAgICAkbmF2Lm9uKCdjbGljaycsICdsaScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY29uc3QgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICBjb25zdCBpZHggPSAkKHRoaXMpLmluZGV4KCk7XHJcblxyXG4gICAgICAkYm9keS5zdG9wKCkuYW5pbWF0ZSh7XHJcbiAgICAgICAgc2Nyb2xsVG9wOiBpZHggPT09IDAgPyAwIDogJHRpbWVsaW5lSXRlbS5lcShpZHgpLm9mZnNldCgpLnRvcCAtICg2MCArIGhlYWRlckhlaWdodCksXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY3JlYXRlVGltZWxpbmVZZWFyTmF2ID0gKGxpc3QpID0+IHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIGA8dWw+YCArXHJcbiAgICAgIGxpc3RcclxuICAgICAgICAubWFwKChlKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gYDxsaSBjbGFzcz1cIm5hdmlnYXRpb25fX2l0ZW1cIj4ke2UueWVhcn08L2xpPmA7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuam9pbignJykgK1xyXG4gICAgICBgPC91bD5gXHJcbiAgICApO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNyZWF0ZVRpbWVsaW5lID0gKGxpc3QpID0+IHtcclxuICAgIHJldHVybiBsaXN0XHJcbiAgICAgIC5tYXAoKGUpID0+IHtcclxuICAgICAgICByZXR1cm4gYFxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lbGluZV9faXRlbVwiPlxyXG4gICAgICAgICAgPHAgY2xhc3M9XCJ0aW1lbGluZV9faXRlbS15ZWFyXCI+JHtlLnllYXJ9PC9wPlxyXG4gICAgICAgICAgJHtjcmVhdGVUaW1lbGluZUl0ZW0oZS5wb3J0Zm9saW8pfVxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICBgO1xyXG4gICAgICB9KVxyXG4gICAgICAuam9pbignJyk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY3JlYXRlVGltZWxpbmVJdGVtID0gKGl0ZW0pID0+IHtcclxuICAgIHJldHVybiBpdGVtXHJcbiAgICAgIC5tYXAoKGUpID0+IHtcclxuICAgICAgICByZXR1cm4gYFxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lbGluZV9faXRlbS1jb250ZW50XCI+XHJcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZFwiPlxyXG4gICAgICAgICAgICA8ZmlndXJlPlxyXG4gICAgICAgICAgICA8aW1nIHNyYz1cIiR7ZS5pbWFnZXN9XCIgYWx0PVwiJHtlLnRpdGxlfVwiPlxyXG4gICAgICAgICAgICA8L2ZpZ3VyZT5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtc3VtbWFyeVwiPlxyXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWNhdGVnb3J5XCI+JHtlLmRldmljZX08L2Rpdj5cclxuICAgICAgICAgICAgICA8aDI+JHtlLnRpdGxlfTwvaDI+XHJcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtZGVzY3JpcHRpb25cIj4ke2UuZGVzY3JpcHRpb259PC9kaXY+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8YSBocmVmPVwiJHtlLmxpbmt9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+PC9hPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgYDtcclxuICAgICAgfSlcclxuICAgICAgLmpvaW4oJycpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGZsaWNrZXIgPSB7XHJcbiAgICB1bmljb2RlOiAnIVwiIyQlXFwnKCkqKywtLi8wMTIzNDU2Nzg5Ojs/QGBhQWJCY0NkRGVFZkZnR2hIaUlqSmtLbExtTW5Ob09wUHFRclJzU3RUdVV2VndXeFh5WXpae1t8fV1+Xl8nLFxyXG4gICAgZ2V0UmFuZG9tSW50OiBmdW5jdGlvbiAobWluLCBtYXgpIHtcclxuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbiAgICB9LFxyXG4gICAgcmFuZG9tQ2hhcmFjdGVyOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnVuaWNvZGVbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy51bmljb2RlLmxlbmd0aCldO1xyXG4gICAgfSxcclxuICAgIHJlcGxhY2VBdDogZnVuY3Rpb24gKHRleHQsIGNoYXJhY3RlciwgaW5kZXgpIHtcclxuICAgICAgcmV0dXJuIHRleHQuc3Vic3RyKDAsIGluZGV4KSArIGNoYXJhY3RlciArIHRleHQuc3Vic3RyKGluZGV4ICsgY2hhcmFjdGVyLmxlbmd0aCk7XHJcbiAgICB9LFxyXG4gICAgaW5pdDogZnVuY3Rpb24gKGVsLCBtaW4sIG1heCwgZGVsYXkpIHtcclxuICAgICAgdmFyIHN0ciA9ICQoZWwpLnRleHQoKS50cmltKCksXHJcbiAgICAgICAgYmFuayA9IFtdLFxyXG4gICAgICAgIGRvbmUgPSAxLFxyXG4gICAgICAgIG5ld1N0ciA9ICQoZWwpLnRleHQoKS50cmltKCk7XHJcblxyXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGJhbmtbaV0gPSB0aGlzLmdldFJhbmRvbUludChtaW4sIG1heCk7XHJcbiAgICAgIH1cclxuICAgICAgZmxpY2tlci5taXgoZWwsIHN0ciwgbmV3U3RyLCBkb25lLCBiYW5rLCBkZWxheSk7XHJcbiAgICB9LFxyXG4gICAgbWl4OiBmdW5jdGlvbiAoZWwsIHN0ciwgbmV3U3RyLCBkb25lLCBiYW5rLCBkZWxheSkge1xyXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChiYW5rW2ldICE9IDApIHtcclxuICAgICAgICAgIGRvbmUgPSAwO1xyXG4gICAgICAgICAgaWYgKHN0cltpXSAhPSAnICcpIHtcclxuICAgICAgICAgICAgbmV3U3RyID0gdGhpcy5yZXBsYWNlQXQobmV3U3RyLCB0aGlzLnJhbmRvbUNoYXJhY3RlcigpLCBpKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG5ld1N0ciA9IHRoaXMucmVwbGFjZUF0KG5ld1N0ciwgJyAnLCBpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJhbmtbaV0tLTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbmV3U3RyID0gdGhpcy5yZXBsYWNlQXQobmV3U3RyLCBzdHJbaV0sIGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgJChlbCkudGV4dChuZXdTdHIpLmZhZGVJbigxMDAwKTtcclxuICAgICAgaWYgKGRvbmUgPT0gMCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgZmxpY2tlci5taXgoZWwsIHN0ciwgbmV3U3RyLCBkb25lLCBiYW5rLCBkZWxheSk7XHJcbiAgICAgICAgfSwgZGVsYXkpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gIH07XHJcblxyXG4gICRnb3RvcC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICRib2R5LnN0b3AoKS5hbmltYXRlKHtcclxuICAgICAgc2Nyb2xsVG9wOiAwLFxyXG4gICAgfSw1MDAsICdzd2luZycgKTtcclxuICB9KVxyXG4gIFxyXG4gIFxyXG5cclxuICBmZXRjaERhdGEoKTtcclxuICBmbGlja2VyLmluaXQoJ2gxIHNwYW4nLCAxLCAxNSwgNTApO1xyXG59KShqUXVlcnkpO1xyXG4iXSwiZmlsZSI6InBvcnRmb2xpby5qcyJ9
