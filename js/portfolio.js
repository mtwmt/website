"use strict";

(function ($) {
  var $win = $(window);
  var $body = $('html,body');
  var $main = $('main');
  var windowHeight = $win.height();
  var headerHeight = $('header').outerHeight(true);
  var $navigation = $('.navigation');
  var $gotop = $('#gotop');
  var $timelineItem;
  var $nav;
  $main.css({
    paddingTop: headerHeight
  });

  var fetchData = function fetchData() {
    $.ajax({
      url: 'data.json',
      method: 'get',
      dataType: 'json',
      data: {},
      success: function success(data) {
        data = data || {};
        var $timeline = $('.timeline').append($(createTimeline(data)));
        $nav = $('.navigation').append(createTimelineYearNav(data));
        $timelineItem = $timeline.find('.timeline__item');
        winScorll();
        onYear();
      }
    });
  };

  var winScorll = function winScorll() {
    $win.on('scroll', function () {
      var $this = $(this);
      var scrollTop = $this.scrollTop();
      var totalHeight = $('main').offset().top + $('main').outerHeight(true) - windowHeight;
      var idx = 0;
      $timelineItem.map(function (i, e) {
        if (scrollTop > $(e).offset().top - 200) {
          idx = i;
        } else if (scrollTop > $(document).height() - $win.height() - $timelineItem.eq($timelineItem.length - 1).outerHeight(true) / 2) {
          idx = $timelineItem.length - 1;
        }
      });
      $nav.find('li').eq(idx).addClass('navigation__item--active').siblings().removeClass('navigation__item--active');
      $('.loadbar').css({
        width: scrollTop / totalHeight * 100 + '%'
      });
      $('.timeline__item .timeline__item-content').not('.on').map(function () {
        if (windowHeight + $win.scrollTop() > $(this).offset().top) {
          $(this).addClass('on');
        }
      });

      if (scrollTop >= headerHeight) {
        $gotop.css({
          opacity: 1
        });
      } else {
        $gotop.css({
          opacity: 0
        });
      }
    }).scroll();
  };

  var onYear = function onYear() {
    $nav.on('click', 'li', function () {
      var $this = $(this);
      var idx = $(this).index();
      $body.stop().animate({
        scrollTop: idx === 0 ? 0 : $timelineItem.eq(idx).offset().top - (60 + headerHeight)
      });
    });
  };

  var createTimelineYearNav = function createTimelineYearNav(list) {
    return "<ul>" + list.map(function (e) {
      return "<li class=\"navigation__item\">".concat(e.year, "</li>");
    }).join('') + "</ul>";
  };

  var createTimeline = function createTimeline(list) {
    return list.map(function (e) {
      return "\n        <div class=\"timeline__item\">\n          <p class=\"timeline__item-year\">".concat(e.year, "</p>\n          ").concat(createTimelineItem(e.portfolio), "\n        </div>\n      ");
    }).join('');
  };

  var createTimelineItem = function createTimelineItem(item) {
    return item.map(function (e) {
      return "\n        <div class=\"timeline__item-content\">\n          <div class=\"card\">\n            <figure>\n            <img src=\"".concat(e.images, "\" alt=\"").concat(e.title, "\">\n            </figure>\n            <div class=\"card-summary\">\n              <div class=\"card-category\">").concat(e.device, "</div>\n              <h2>").concat(e.title, "</h2>\n              <div class=\"card-description\">").concat(e.description, "</div>\n            </div>\n            <a href=\"").concat(e.link, "\" target=\"_blank\"></a>\n          </div>\n        </div>\n        ");
    }).join('');
  };

  var flicker = {
    unicode: '!"#$%\'()*+,-./0123456789:;?@`aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ{[|}]~^_',
    getRandomInt: function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    },
    randomCharacter: function randomCharacter() {
      return this.unicode[Math.floor(Math.random() * this.unicode.length)];
    },
    replaceAt: function replaceAt(text, character, index) {
      return text.substr(0, index) + character + text.substr(index + character.length);
    },
    init: function init(el, min, max, delay) {
      var str = $(el).text().trim(),
          bank = [],
          done = 1,
          newStr = $(el).text().trim();

      for (var i = 0; i < str.length; i++) {
        bank[i] = this.getRandomInt(min, max);
      }

      flicker.mix(el, str, newStr, done, bank, delay);
    },
    mix: function mix(el, str, newStr, done, bank, delay) {
      for (var i = 0; i < str.length; i++) {
        if (bank[i] != 0) {
          done = 0;

          if (str[i] != ' ') {
            newStr = this.replaceAt(newStr, this.randomCharacter(), i);
          } else {
            newStr = this.replaceAt(newStr, ' ', i);
          }

          bank[i]--;
        } else {
          newStr = this.replaceAt(newStr, str[i], i);
        }
      }

      $(el).text(newStr).fadeIn(1000);

      if (done == 0) {
        setTimeout(function () {
          flicker.mix(el, str, newStr, done, bank, delay);
        }, delay);
      }
    }
  };
  $gotop.on('click', function () {
    $body.stop().animate({
      scrollTop: 0
    }, 500, 'swing');
  });
  fetchData();
  flicker.init('h1 span', 1, 15, 50);
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBvcnRmb2xpby5qcyJdLCJuYW1lcyI6WyIkIiwiJHdpbiIsIndpbmRvdyIsIiRib2R5IiwiJG1haW4iLCJ3aW5kb3dIZWlnaHQiLCJoZWlnaHQiLCJoZWFkZXJIZWlnaHQiLCJvdXRlckhlaWdodCIsIiRuYXZpZ2F0aW9uIiwiJGdvdG9wIiwiJHRpbWVsaW5lSXRlbSIsIiRuYXYiLCJjc3MiLCJwYWRkaW5nVG9wIiwiZmV0Y2hEYXRhIiwiYWpheCIsInVybCIsIm1ldGhvZCIsImRhdGFUeXBlIiwiZGF0YSIsInN1Y2Nlc3MiLCIkdGltZWxpbmUiLCJhcHBlbmQiLCJjcmVhdGVUaW1lbGluZSIsImNyZWF0ZVRpbWVsaW5lWWVhck5hdiIsImZpbmQiLCJ3aW5TY29ybGwiLCJvblllYXIiLCJvbiIsIiR0aGlzIiwic2Nyb2xsVG9wIiwidG90YWxIZWlnaHQiLCJvZmZzZXQiLCJ0b3AiLCJpZHgiLCJtYXAiLCJpIiwiZSIsImRvY3VtZW50IiwiZXEiLCJsZW5ndGgiLCJhZGRDbGFzcyIsInNpYmxpbmdzIiwicmVtb3ZlQ2xhc3MiLCJ3aWR0aCIsIm5vdCIsIm9wYWNpdHkiLCJzY3JvbGwiLCJpbmRleCIsInN0b3AiLCJhbmltYXRlIiwibGlzdCIsInllYXIiLCJqb2luIiwiY3JlYXRlVGltZWxpbmVJdGVtIiwicG9ydGZvbGlvIiwiaXRlbSIsImltYWdlcyIsInRpdGxlIiwiZGV2aWNlIiwiZGVzY3JpcHRpb24iLCJsaW5rIiwiZmxpY2tlciIsInVuaWNvZGUiLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21DaGFyYWN0ZXIiLCJyZXBsYWNlQXQiLCJ0ZXh0IiwiY2hhcmFjdGVyIiwic3Vic3RyIiwiaW5pdCIsImVsIiwiZGVsYXkiLCJzdHIiLCJ0cmltIiwiYmFuayIsImRvbmUiLCJuZXdTdHIiLCJtaXgiLCJmYWRlSW4iLCJzZXRUaW1lb3V0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiOztBQUFBLENB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LFNBUkQsTUFRTztBQUNMOEMsVUFBQUEsTUFBTSxHQUFHLEtBQUtYLFNBQUwsQ0FBZVcsTUFBZixFQUF1QkosR0FBRyxDQUFDMUMsQ0FBRCxDQUExQixFQUErQkEsQ0FBL0IsQ0FBVDtBQUNEO0FBQ0Y7O0FBRURyQyxNQUFBQSxDQUFDLENBQUM2RSxFQUFELENBQUQsQ0FBTUosSUFBTixDQUFXVSxNQUFYLEVBQW1CRSxNQUFuQixDQUEwQixJQUExQjs7QUFDQSxVQUFJSCxJQUFJLElBQUksQ0FBWixFQUFlO0FBQ2JJLFFBQUFBLFVBQVUsQ0FBQyxZQUFZO0FBQ3JCdkIsVUFBQUEsT0FBTyxDQUFDcUIsR0FBUixDQUFZUCxFQUFaLEVBQWdCRSxHQUFoQixFQUFxQkksTUFBckIsRUFBNkJELElBQTdCLEVBQW1DRCxJQUFuQyxFQUF5Q0gsS0FBekM7QUFDRCxTQUZTLEVBRVBBLEtBRk8sQ0FBVjtBQUdEO0FBQ0Y7QUEzQ2EsR0FBaEI7QUE4Q0FwRSxFQUFBQSxNQUFNLENBQUNtQixFQUFQLENBQVUsT0FBVixFQUFtQixZQUFXO0FBQzVCMUIsSUFBQUEsS0FBSyxDQUFDK0MsSUFBTixHQUFhQyxPQUFiLENBQXFCO0FBQ25CcEIsTUFBQUEsU0FBUyxFQUFFO0FBRFEsS0FBckIsRUFFRSxHQUZGLEVBRU8sT0FGUDtBQUdELEdBSkQ7QUFRQWhCLEVBQUFBLFNBQVM7QUFDVGdELEVBQUFBLE9BQU8sQ0FBQ2EsSUFBUixDQUFhLFNBQWIsRUFBd0IsQ0FBeEIsRUFBMkIsRUFBM0IsRUFBK0IsRUFBL0I7QUFDRCxDQXhMRCxFQXdMR1csTUF4TEgiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCQpIHtcbiAgY29uc3QgJHdpbiA9ICQod2luZG93KTtcbiAgY29uc3QgJGJvZHkgPSAkKCdodG1sLGJvZHknKTtcbiAgY29uc3QgJG1haW4gPSAkKCdtYWluJyk7XG4gIGNvbnN0IHdpbmRvd0hlaWdodCA9ICR3aW4uaGVpZ2h0KCk7XG4gIGNvbnN0IGhlYWRlckhlaWdodCA9ICQoJ2hlYWRlcicpLm91dGVySGVpZ2h0KHRydWUpO1xuICBjb25zdCAkbmF2aWdhdGlvbiA9ICQoJy5uYXZpZ2F0aW9uJyk7XG4gIGNvbnN0ICRnb3RvcCA9ICQoJyNnb3RvcCcpO1xuICBsZXQgJHRpbWVsaW5lSXRlbTtcbiAgbGV0ICRuYXY7XG5cbiAgJG1haW4uY3NzKHsgcGFkZGluZ1RvcDogaGVhZGVySGVpZ2h0IH0pO1xuXG4gIGNvbnN0IGZldGNoRGF0YSA9ICgpID0+IHtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiAnZGF0YS5qc29uJyxcbiAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgZGF0YToge30sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBkYXRhID0gZGF0YSB8fCB7fTtcblxuICAgICAgICBjb25zdCAkdGltZWxpbmUgPSAkKCcudGltZWxpbmUnKS5hcHBlbmQoJChjcmVhdGVUaW1lbGluZShkYXRhKSkpO1xuICAgICAgICAkbmF2ID0gJCgnLm5hdmlnYXRpb24nKS5hcHBlbmQoY3JlYXRlVGltZWxpbmVZZWFyTmF2KGRhdGEpKTtcbiAgICAgICAgJHRpbWVsaW5lSXRlbSA9ICR0aW1lbGluZS5maW5kKCcudGltZWxpbmVfX2l0ZW0nKTtcblxuICAgICAgICB3aW5TY29ybGwoKTtcbiAgICAgICAgb25ZZWFyKCk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHdpblNjb3JsbCA9ICgpID0+IHtcbiAgICAkd2luXG4gICAgICAub24oJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICBjb25zdCBzY3JvbGxUb3AgPSAkdGhpcy5zY3JvbGxUb3AoKTtcbiAgICAgICAgY29uc3QgdG90YWxIZWlnaHQgPSAkKCdtYWluJykub2Zmc2V0KCkudG9wICsgJCgnbWFpbicpLm91dGVySGVpZ2h0KHRydWUpIC0gd2luZG93SGVpZ2h0O1xuICAgICAgICBsZXQgaWR4ID0gMDtcblxuICAgICAgICAkdGltZWxpbmVJdGVtLm1hcCgoaSwgZSkgPT4ge1xuICAgICAgICAgIGlmIChzY3JvbGxUb3AgPiAkKGUpLm9mZnNldCgpLnRvcCAtIDIwMCkge1xuICAgICAgICAgICAgaWR4ID0gaTtcbiAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgc2Nyb2xsVG9wID5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLmhlaWdodCgpIC0gJHdpbi5oZWlnaHQoKSAtICR0aW1lbGluZUl0ZW0uZXEoJHRpbWVsaW5lSXRlbS5sZW5ndGggLSAxKS5vdXRlckhlaWdodCh0cnVlKSAvIDJcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGlkeCA9ICR0aW1lbGluZUl0ZW0ubGVuZ3RoIC0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRuYXYuZmluZCgnbGknKS5lcShpZHgpLmFkZENsYXNzKCduYXZpZ2F0aW9uX19pdGVtLS1hY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCduYXZpZ2F0aW9uX19pdGVtLS1hY3RpdmUnKTtcbiAgICAgICAgJCgnLmxvYWRiYXInKS5jc3MoeyB3aWR0aDogKHNjcm9sbFRvcCAvIHRvdGFsSGVpZ2h0KSAqIDEwMCArICclJyB9KTtcblxuICAgICAgICAkKCcudGltZWxpbmVfX2l0ZW0gLnRpbWVsaW5lX19pdGVtLWNvbnRlbnQnKS5ub3QoJy5vbicpLm1hcChmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiggd2luZG93SGVpZ2h0ICsgJHdpbi5zY3JvbGxUb3AoKSA+ICQodGhpcykub2Zmc2V0KCkudG9wICkge1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnb24nKVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuXG4gICAgICAgIGlmKHNjcm9sbFRvcCA+PSBoZWFkZXJIZWlnaHQgKXtcbiAgICAgICAgICAkZ290b3AuY3NzKHsgb3BhY2l0eTogMSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkZ290b3AuY3NzKHsgb3BhY2l0eTogMCB9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5zY3JvbGwoKTtcbiAgfTtcblxuICBjb25zdCBvblllYXIgPSAoKSA9PiB7XG4gICAgJG5hdi5vbignY2xpY2snLCAnbGknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCAkdGhpcyA9ICQodGhpcyk7XG4gICAgICBjb25zdCBpZHggPSAkKHRoaXMpLmluZGV4KCk7XG5cbiAgICAgICRib2R5LnN0b3AoKS5hbmltYXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wOiBpZHggPT09IDAgPyAwIDogJHRpbWVsaW5lSXRlbS5lcShpZHgpLm9mZnNldCgpLnRvcCAtICg2MCArIGhlYWRlckhlaWdodCksXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBjcmVhdGVUaW1lbGluZVllYXJOYXYgPSAobGlzdCkgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICBgPHVsPmAgK1xuICAgICAgbGlzdFxuICAgICAgICAubWFwKChlKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGA8bGkgY2xhc3M9XCJuYXZpZ2F0aW9uX19pdGVtXCI+JHtlLnllYXJ9PC9saT5gO1xuICAgICAgICB9KVxuICAgICAgICAuam9pbignJykgK1xuICAgICAgYDwvdWw+YFxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlVGltZWxpbmUgPSAobGlzdCkgPT4ge1xuICAgIHJldHVybiBsaXN0XG4gICAgICAubWFwKChlKSA9PiB7XG4gICAgICAgIHJldHVybiBgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJ0aW1lbGluZV9faXRlbVwiPlxuICAgICAgICAgIDxwIGNsYXNzPVwidGltZWxpbmVfX2l0ZW0teWVhclwiPiR7ZS55ZWFyfTwvcD5cbiAgICAgICAgICAke2NyZWF0ZVRpbWVsaW5lSXRlbShlLnBvcnRmb2xpbyl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgYDtcbiAgICAgIH0pXG4gICAgICAuam9pbignJyk7XG4gIH07XG5cbiAgY29uc3QgY3JlYXRlVGltZWxpbmVJdGVtID0gKGl0ZW0pID0+IHtcbiAgICByZXR1cm4gaXRlbVxuICAgICAgLm1hcCgoZSkgPT4ge1xuICAgICAgICByZXR1cm4gYFxuICAgICAgICA8ZGl2IGNsYXNzPVwidGltZWxpbmVfX2l0ZW0tY29udGVudFwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkXCI+XG4gICAgICAgICAgICA8ZmlndXJlPlxuICAgICAgICAgICAgPGltZyBzcmM9XCIke2UuaW1hZ2VzfVwiIGFsdD1cIiR7ZS50aXRsZX1cIj5cbiAgICAgICAgICAgIDwvZmlndXJlPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtc3VtbWFyeVwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZC1jYXRlZ29yeVwiPiR7ZS5kZXZpY2V9PC9kaXY+XG4gICAgICAgICAgICAgIDxoMj4ke2UudGl0bGV9PC9oMj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtZGVzY3JpcHRpb25cIj4ke2UuZGVzY3JpcHRpb259PC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxhIGhyZWY9XCIke2UubGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIj48L2E+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCcnKTtcbiAgfTtcblxuICBjb25zdCBmbGlja2VyID0ge1xuICAgIHVuaWNvZGU6ICchXCIjJCVcXCcoKSorLC0uLzAxMjM0NTY3ODk6Oz9AYGFBYkJjQ2REZUVmRmdHaEhpSWpKa0tsTG1Nbk5vT3BQcVFyUnNTdFR1VXZWd1d4WHlZelp7W3x9XX5eXycsXG4gICAgZ2V0UmFuZG9tSW50OiBmdW5jdGlvbiAobWluLCBtYXgpIHtcbiAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xuICAgIH0sXG4gICAgcmFuZG9tQ2hhcmFjdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy51bmljb2RlW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMudW5pY29kZS5sZW5ndGgpXTtcbiAgICB9LFxuICAgIHJlcGxhY2VBdDogZnVuY3Rpb24gKHRleHQsIGNoYXJhY3RlciwgaW5kZXgpIHtcbiAgICAgIHJldHVybiB0ZXh0LnN1YnN0cigwLCBpbmRleCkgKyBjaGFyYWN0ZXIgKyB0ZXh0LnN1YnN0cihpbmRleCArIGNoYXJhY3Rlci5sZW5ndGgpO1xuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24gKGVsLCBtaW4sIG1heCwgZGVsYXkpIHtcbiAgICAgIHZhciBzdHIgPSAkKGVsKS50ZXh0KCkudHJpbSgpLFxuICAgICAgICBiYW5rID0gW10sXG4gICAgICAgIGRvbmUgPSAxLFxuICAgICAgICBuZXdTdHIgPSAkKGVsKS50ZXh0KCkudHJpbSgpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICBiYW5rW2ldID0gdGhpcy5nZXRSYW5kb21JbnQobWluLCBtYXgpO1xuICAgICAgfVxuICAgICAgZmxpY2tlci5taXgoZWwsIHN0ciwgbmV3U3RyLCBkb25lLCBiYW5rLCBkZWxheSk7XG4gICAgfSxcbiAgICBtaXg6IGZ1bmN0aW9uIChlbCwgc3RyLCBuZXdTdHIsIGRvbmUsIGJhbmssIGRlbGF5KSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoYmFua1tpXSAhPSAwKSB7XG4gICAgICAgICAgZG9uZSA9IDA7XG4gICAgICAgICAgaWYgKHN0cltpXSAhPSAnICcpIHtcbiAgICAgICAgICAgIG5ld1N0ciA9IHRoaXMucmVwbGFjZUF0KG5ld1N0ciwgdGhpcy5yYW5kb21DaGFyYWN0ZXIoKSwgaSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld1N0ciA9IHRoaXMucmVwbGFjZUF0KG5ld1N0ciwgJyAnLCBpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYmFua1tpXS0tO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld1N0ciA9IHRoaXMucmVwbGFjZUF0KG5ld1N0ciwgc3RyW2ldLCBpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAkKGVsKS50ZXh0KG5ld1N0cikuZmFkZUluKDEwMDApO1xuICAgICAgaWYgKGRvbmUgPT0gMCkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmbGlja2VyLm1peChlbCwgc3RyLCBuZXdTdHIsIGRvbmUsIGJhbmssIGRlbGF5KTtcbiAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgJGdvdG9wLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICRib2R5LnN0b3AoKS5hbmltYXRlKHtcbiAgICAgIHNjcm9sbFRvcDogMCxcbiAgICB9LDUwMCwgJ3N3aW5nJyApO1xuICB9KVxuICBcbiAgXG5cbiAgZmV0Y2hEYXRhKCk7XG4gIGZsaWNrZXIuaW5pdCgnaDEgc3BhbicsIDEsIDE1LCA1MCk7XG59KShqUXVlcnkpO1xuIl0sImZpbGUiOiJwb3J0Zm9saW8uanMifQ==
